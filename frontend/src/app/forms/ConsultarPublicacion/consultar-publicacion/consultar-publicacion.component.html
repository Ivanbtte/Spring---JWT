<app-nav></app-nav>
<app-sidebar></app-sidebar>
<div class="container">
    <h3>Consultar publicaciones</h3>

    <div class="card-container">
        <!--Bloque Taller Izquierdo-->
        <div class="card mt-4 altura">
            <!--Cuadro superior I-->
            <div class="card-body">
                <!-- Contenedor para Filtro por Estado e Instituto -->
                <div class="form-group-container">
                    <!-- Filtro por Estado de Publicación -->
                    <div class="form-group">
                        <label>
                            <input type="checkbox" [(ngModel)]="filtrarPorEstado" [ngModelOptions]="{standalone: true}"
                                (change)="onCheckboxChange('estado')" />
                            Filtrar por estado de publicación <i class="fa fa-archive"></i>
                        </label>
                        <div *ngIf="filtrarPorEstado" class="form-group">
                            <label for="estado">Estado de la publicación</label>
                            <select id="estado" [(ngModel)]="selectedEstado" name="estado" (change)="onEstadoChange()">
                                <option [value]="1">Recientes</option>
                                <option [value]="2">Rechazados</option>
                                <option [value]="3">Sin Revisar</option>
                                <option [value]="4">Aceptados</option>
                            </select>
                        </div>
                    </div>
            
                    <!-- Filtro por Instituto (condicionado por rol) -->
                    <div class="form-group" *ngIf="userRole === 'ADMIN' || userRole === 'ROOT'">
                        <label>
                            <input type="checkbox" [(ngModel)]="filtrarPorInstituto" [ngModelOptions]="{standalone: true}"
                                (change)="onCheckboxChange('instituto')" />
                            Filtrar por instituto <i class="fa fa-university"></i>
                        </label>
                        <div *ngIf="filtrarPorInstituto" class="form-group">
                            <label for="instituto">Instituto</label>
                            <select class="form-control" id="instituto" [(ngModel)]="selectedInstituto" name="instituto">
                                <option value="">Seleccione un instituto</option>
                                <option *ngFor="let instituto of institutos" [value]="instituto.id">
                                    {{ instituto.nombre }}
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            

            <!--Cuadro inferior III-->
            <div class="card-body">
                <form (ngSubmit)="searchPublications()">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" [(ngModel)]="filtrarPorProfesor" (change)="onFilterChange()"
                                [ngModelOptions]="{standalone: true}" (change)="onCheckboxChange('profesor')" />
                            Filtrar por profesor <i class="fa fa-user"></i>
                        </label>
                    </div>
                    <div *ngIf="filtrarPorProfesor">
                        <div class="form-group-container">
                            <div class="form-group">
                                <label for="institutoProfesor">Instituto</label>
                                <select class="form-control" id="institutoProfesor"
                                    [(ngModel)]="selectedInstituteForProfessor" name="institutoForProfesor"
                                    (change)="onInstituteForProfessorChange()">
                                    <option value="">Seleccione un instituto</option>
                                    <option *ngFor="let instituto of institutos" [value]="instituto.id">{{
                                        instituto.nombre }}</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="profesor">Profesor</label>
                                <select class="form-control" id="profesor" [(ngModel)]="selectedProfesor"
                                    name="profesor">
                                    <option value="">Seleccione un profesor</option>
                                    <option *ngFor="let profesor of profesoresFiltrados" [value]="profesor.id">{{
                                        profesor.nombre_1_investigador }} {{ profesor.nombre_2_investigador }} {{
                                        profesor.apellido_paterno_1_investigador }} {{
                                        profesor.apellido_materno_2_investigador }}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                </form>
            </div>
        </div>

        <!--Bloque Taller Derecho-->
        <div class="card mt-4 altura">
            <!--Cuadro superior II-->
            <div class="card-body">
                <form>
                    <!-- Checkbox para seleccionar Fecha o Trimestre -->
                    <!-- Checkbox para seleccionar Fecha o Trimestre -->
                    <div class="form-group form-group-horizontal">
                        <label>
                            <input type="checkbox" [(ngModel)]="filtrarPorFechas" [ngModelOptions]="{standalone: true}"
                                (change)="onCheckboxChange('fechas')" />
                            Filtrar por fechas <i class="fa fa-calendar"></i>
                        </label>
                        <label>
                            <input type="checkbox" [(ngModel)]="filtrarPorTrimestre"
                                [ngModelOptions]="{standalone: true}" (change)="onCheckboxChange('trimestre')" />
                            Filtrar por trimestre <i class="fa fa-calendar"></i>
                        </label>
                    </div>


                    <!-- Si se selecciona Filtrar por Fechas -->
                    <div *ngIf="filtrarPorFechas" class="form-group-container-inline">
                        <div class="form-group">
                            <label for="startDate">Fecha de Inicio</label>
                            <input type="date" id="start" name="start" [(ngModel)]="startDate" class="form-control" />
                        </div>
                        <div class="form-group">
                            <label for="endDate">Fecha Final</label>
                            <input type="date" id="end" name="end" [(ngModel)]="endDate" class="form-control" />
                        </div>
                    </div>

                    <!-- Si se selecciona Filtrar por Trimestre -->
                    <div *ngIf="filtrarPorTrimestre" class="form-group-container-inline">
                        <div class="form-group">
                            <label for="trimestre">Trimestre</label>
                            <select id="trimestre" [(ngModel)]="selectedTrimestre" name="trimestre"
                                (change)="onTrimestreChange()">
                                <option [value]="1">Trimestre 1</option>
                                <option [value]="2">Trimestre 2</option>
                                <option [value]="3">Trimestre 3</option>
                                <option [value]="4">Trimestre 4</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="anio">Seleccionar Año</label>
                            <select id="anio" [(ngModel)]="selectedAnio" name="anio" (change)="onTrimestreChange()">
                                <option *ngFor="let anio of listaAnios" [value]="anio">{{anio}}</option>
                            </select>
                        </div>
                    </div>

                </form>
            </div>

            <!--Cuadro inferior IV-->
            <div class="card-body">
                <form>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" [(ngModel)]="filtrarPorTipo" [ngModelOptions]="{standalone: true}"
                                (change)="onCheckboxChange('tipo')" />
                            Filtrar por tipo de publicación <i class="fa fa-file"></i>
                        </label>
                    </div>
                    <div *ngIf="filtrarPorTipo" class="form-group">
                        <label for="publicacion">Tipo de publicación</label>
                        <select class="form-control" id="tipo_publicacion" [(ngModel)]="selectedTipoPublicacion"
                            name="publicacion">
                            <option value="">Seleccione un tipo de publicación</option>
                            <option *ngFor="let tipo_publicacion of tipo_publicaciones"
                                [value]="tipo_publicacion.id_publicacion_tipo">{{
                                tipo_publicacion.descripcion_publicacion_tipo }}</option>
                        </select>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Botón de búsqueda -->
    <button type="button" class="btn btn-primary" (click)="searchPublications()">
        <i class="fa fa-search" aria-hidden="true"></i> Buscar
    </button>

    <!-- Botón para descargar Excel -->
    <button type="button" class="btn btn-success" (click)="reporteExe()">
        <i class="fa fa-file-excel-o" aria-hidden="true"></i> Descargar Excel
    </button>


    <!-- Botón de descarga de zip-->
    <button type="button" class="btn btn-primary" (click)="dowloadZip()"><i class="fa fa-download"
            aria-hidden="true"></i>
        Descargar archivos</button>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Titulo de publicacion</th>
                <th>Fecha de publicación</th>
                <th>Observaciones Director</th>
                <th>Observaciones Gestión</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let articulo of articulosFiltrados| paginate: { itemsPerPage: 10, currentPage: p }">
                <td>{{articulo.nombre_articulo}}</td>
                <td>{{formatDate(articulo.fecha_publicacion)}}</td>
                <td>{{articulo.observaciones_directores}}</td>
                <td>{{articulo.observaciones_gestion}}</td>
                <td>
                    <button class="btn btn-primary" (click)="editarArticulo(articulo)">
                        <i class="fa fa-edit"></i> Revisar
                    </button>
                </td>
            </tr>
        </tbody>
    </table>
    <!-- Controles de paginación -->
    <pagination-controls (pageChange)="p = $event" previousLabel="Anterior" nextLabel="Siguiente">
    </pagination-controls>
</div>