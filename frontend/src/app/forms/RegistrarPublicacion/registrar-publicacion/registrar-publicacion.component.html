<app-nav></app-nav>
<app-menu></app-menu>
<div class="container">
  <h2>Registrar</h2>
  <form>
    <div class="form-group highlighted-field">
      <label for="tipoPublicacion">Tipo de publicación</label>
      <select id="tipoPublicacion" class="form-control" [(ngModel)]="tipoPublicacion" name="tipoPublicacion">
        <option>Artículo</option>
        <option>Libro</option>
        <option>Capítulo de libro</option>
      </select>
    </div>
    <!-- Sección para Articulo -->
    <div *ngIf="tipoPublicacion === 'Artículo'">
      <div class="form-group">
        <label for="titulo">Título del artículo</label>
        <input type="text" id="titulo" class="form-control" [(ngModel)]="titulo" name="titulo" required>
      </div>
      <div class="form-group">
        <label for="nombreRevista">Nombre de la revista</label>
        <input type="text" id="nombreRevista" class="form-control" [(ngModel)]="nombreRevista" name="nombreRevista"
          required>
      </div>
      <div class="form-group">
        <label for="institutoPublicacion">Instituto de afiliación</label>
        <select id="institutoPublicacion" class="form-control" [(ngModel)]="selectedInstitutoPublicacion"
          name="institutoPublicacion">
          <option *ngFor="let instituto of institutosPublicacion" [value]="instituto.id">{{ instituto.nombre }}</option>
        </select>
      </div>
      <div class="form-group">
        <label>Autores</label>
        <button type="button" class="btn btn-primary" (click)="agregarInvestigador()">
          <i class="fa fa-plus"></i> Agregar persona
        </button>
      </div>

      <div class="card mt-3" *ngFor="let investigador of investigadores; let i = index">
        <div class="card-body">
          <h5 class="card-title">Investigador {{ i + 1 }}</h5>
          <div class="form-group">
            <label>¿Autor UNSIS?</label>
            <input type="checkbox" id="autorUnsis{{ i }}" [(ngModel)]="investigador.autorUnsis" name="autorUnsis{{ i }}"
              [disabled]="investigador.agregado" (change)="onAutorUnsisChange(investigador, i)">
          </div>

          <div *ngIf="investigador.autorUnsis; else noAutorUnsis">
            <div class="form-group">
              <label for="instituto{{ i }}">Instituto</label>
              <select id="instituto{{ i }}" class="form-control" [(ngModel)]="investigador.instituto"
                name="instituto{{ i }}" (change)="onInstitutoChange(investigador.instituto, i)"
                [disabled]="investigador.agregado">
                <option *ngFor="let instituto of institutos" [value]="instituto.id">{{ instituto.nombre }}</option>
              </select>
            </div>
            <div class="form-group">
              <label for="listbox{{ i }}">Lista de autores UNSIS</label>
              <select id="listbox{{ i }}" class="form-control" [(ngModel)]="investigador.autorUnsisSeleccionado"
                name="listbox{{ i }}" [disabled]="investigador.agregado">
                <option *ngFor="let autor of autoresPorInstituto[i]" [value]="autor.autor.id_autor">{{
                  autor.nombre_1_investigador }} {{ autor.nombre_2_investigador }} {{
                  autor.apellido_paterno_1_investigador }} {{ autor.apellido_materno_2_investigador }}</option>
              </select>
            </div>
          </div>
          <ng-template #noAutorUnsis>
            <div class="form-group">
              <label for="primerNombre{{ i }}">Primer nombre:</label>
              <input type="text" id="primerNombre{{ i }}" class="form-control" 
                [(ngModel)]="investigador.primerNombre" 
                name="primerNombre{{ i }}"
                [disabled]="investigador.agregado"
                (keypress)="onKeyPress($event, 'primerNombre')"
                (input)="onInput($event, 'primerNombre')" />
            </div>
            <div class="form-group">
              <label for="segundoNombre{{ i }}">Segundo nombre:</label>
              <input type="text" id="segundoNombre{{ i }}" class="form-control" [(ngModel)]="investigador.segundoNombre"
                name="segundoNombre{{ i }}" [disabled]="investigador.agregado"
                (keypress)="onKeyPress($event, 'segundoNombre')"
                (input)="onInput($event, 'segundoNombre')" />
            </div>
            <div class="form-group">
              <label for="apellidoPaterno{{ i }}">Apellido paterno:</label>
              <input type="text" id="apellidoPaterno{{ i }}" class="form-control"
                [(ngModel)]="investigador.apellidoPaterno" name="apellidoPaterno{{ i }}"
                [disabled]="investigador.agregado"
                (keypress)="onKeyPress($event, 'apellidoPaterno')"
                (input)="onInput($event, 'apellidoPaterno')" />
            </div>
            <div class="form-group">
              <label for="apellidoMaterno{{ i }}">Apellido materno:</label>
              <input type="text" id="apellidoMaterno{{ i }}" class="form-control"
                [(ngModel)]="investigador.apellidoMaterno" name="apellidoMaterno{{ i }}"
                [disabled]="investigador.agregado"
                (keypress)="onKeyPress($event, 'apellidoMaterno')"
                (input)="onInput($event, 'apellidoMaterno')" />
            </div>
          </ng-template>
          <br>
          <button type="button" class="btn btn-secondary"
            (click)="investigador.autorUnsis ? guardarAutorUnsis(investigador.autorUnsisSeleccionado, i) : agregarAutorNoUnsis(investigador, i)"
            *ngIf="!investigador.agregado">
            {{ investigador.autorUnsis ? 'Guardar autor UNSIS' : 'Registrar Autor' }}
          </button>
          <button type="button" class="btn btn-danger" (click)="eliminarInvestigador(i)">
            <i class="fa fa-trash" aria-hidden="true"></i> Eliminar
          </button>
        </div>
      </div>

      <div class="form-group-container">
        <div class="form-group">
          <label for="numVolumen">Número de volumen</label>
          <input type="text" id="numVolumen" class="form-control" [(ngModel)]="numVolumen" name="numVolumen" (keypress)="onKeyPressNumber($event)" />
        </div>
        <div class="form-group">
          <label for="numEmision">Número de emisión</label>
          <input type="number" id="numEmision" class="form-control" [(ngModel)]="numEmision" name="numEmision" (keypress)="onKeyPressNumber($event)"/>
        </div>
      </div>
      <div class="form-group">
        <label for="trimestre">Trimestre</label>
        <select id="trimestre" class="form-control" [(ngModel)]="selectedTrimestre" name="trimestre">
          <option *ngFor="let trimestre of trimestres" [value]="trimestre.id_trimestre">{{ trimestre.nombre }}</option>
        </select>
      </div>
      <div class="form-group">
        <label for="fechaPublicacion">Fecha de publicación</label>
        <input type="date" id="fechaPublicacion" class="form-control" [(ngModel)]="fechaPublicacion"
          name="fechaPublicacion">
      </div>
      <div class="form-group-container">
        <div class="form-group">
          <label for="paginaInicio">Página de inicio</label>
          <input type="number" id="paginaInicio" class="form-control" [(ngModel)]="paginaInicio" name="paginaInicio"   (keypress)="onKeyPressNumber($event)" />
        </div>
        <div class="form-group">
          <label for="paginaFin">Página final</label>
          <input type="number" id="paginaFin" class="form-control" [(ngModel)]="paginaFin" name="paginaFin"    (keypress)="onKeyPressNumber($event)"/>
        </div>
      </div>

      <div class="form-group">
        <label for="doi">DOI</label>
        <input type="text" id="doi" class="form-control" [(ngModel)]="doi" name="doi">
      </div>
      <div class="form-group">
        <label for="doi">Indice MIAR</label>
        <input type="text" id="miar" class="form-control" [(ngModel)]="miar" name="miar">
      </div>

      <div class="form-group">
        <label>Compilado</label>
        <input type="checkbox" id="compilado" [(ngModel)]="compilado" name="compilado"
          (change)="onCheckboxChange($event, 'compilado')">
      </div>
      <div class="form-group">
        <label>Financiamiento Prodep</label>
        <input type="checkbox" id="prodep" [(ngModel)]="prodep" name="prodep"
          (change)="onCheckboxChange($event, 'prodep')">
      </div>

      <button type="button" class="btn btn-success" (click)="crearArticulo()">
        <i class="fa fa-check"></i> Registrar
      </button>
    </div>

    <!-- Sección para Libro -->
    <div *ngIf="tipoPublicacion === 'Libro'">
      <div class="form-group">
        <label for="tituloLibro">Título</label>
        <input type="text" id="tituloLibro" class="form-control" [(ngModel)]="tituloLibro" name="tituloLibro" required>
      </div>
      <div class="form-group">
        <label for="tituloLibro">Editorial</label>
        <input type="text" id="editorialLibro" class="form-control" [(ngModel)]="editorialLibro" name="editorialLibro"
          required>
      </div>
      <div class="form-group">
        <label for="institutoPublicacion">Instituto de afiliación</label>
        <select id="institutoPublicacion" class="form-control" [(ngModel)]="selectedInstitutoPublicacion"
          name="institutoPublicacion">
          <option *ngFor="let instituto of institutosPublicacion" [value]="instituto.id">{{ instituto.nombre }}</option>
        </select>
      </div>
      <div class="form-group">
        <label>Autores</label>
        <button type="button" class="btn btn-primary" (click)="agregarInvestigador()">
          <i class="fa fa-plus"></i> Agregar persona
        </button>
      </div>

      <div class="card mt-3" *ngFor="let investigador of investigadores; let i = index">
        <div class="card-body">
          <h5 class="card-title">Investigador {{ i + 1 }}</h5>
          <div class="form-group">
            <label>¿Autor UNSIS?</label>
            <input type="checkbox" id="autorUnsis{{ i }}" [(ngModel)]="investigador.autorUnsis" name="autorUnsis{{ i }}"
              [disabled]="investigador.agregado" (change)="onAutorUnsisChange(investigador, i)">
          </div>

          <div *ngIf="investigador.autorUnsis; else noAutorUnsis">
            <div class="form-group">
              <label for="instituto{{ i }}">Instituto</label>
              <select id="instituto{{ i }}" class="form-control" [(ngModel)]="investigador.instituto"
                name="instituto{{ i }}" (change)="onInstitutoChange(investigador.instituto, i)"
                [disabled]="investigador.agregado">
                <option *ngFor="let instituto of institutos" [value]="instituto.id">{{ instituto.nombre }}</option>
              </select>
            </div>
            <div class="form-group">
              <label for="listbox{{ i }}">Lista de autores UNSIS</label>
              <select id="listbox{{ i }}" class="form-control" [(ngModel)]="investigador.autorUnsisSeleccionado"
                name="listbox{{ i }}" [disabled]="investigador.agregado">
                <option *ngFor="let autor of autoresPorInstituto[i]" [value]="autor.autor.id_autor">{{
                  autor.nombre_1_investigador }} {{ autor.nombre_2_investigador }} {{
                  autor.apellido_paterno_1_investigador }} {{ autor.apellido_materno_2_investigador }}</option>
              </select>
            </div>
          </div>
          <ng-template #noAutorUnsis>
            <div class="form-group">
              <label for="primerNombre{{ i }}">Primer nombre:</label>
              <input type="text" id="primerNombre{{ i }}" class="form-control" [(ngModel)]="investigador.primerNombre"
                name="primerNombre{{ i }}" [disabled]="investigador.agregado"
                (keypress)="onKeyPress($event, 'primerNombre')"
                (input)="onInput($event, 'primerNombre')" />
            </div>
            <div class="form-group">
              <label for="segundoNombre{{ i }}">Segundo nombre:</label>
              <input type="text" id="segundoNombre{{ i }}" class="form-control" [(ngModel)]="investigador.segundoNombre"
                name="segundoNombre{{ i }}" [disabled]="investigador.agregado"
                (keypress)="onKeyPress($event, 'segundoNombre')"
                (input)="onInput($event, 'segundoNombre')" />
            </div>
            <div class="form-group">
              <label for="apellidoPaterno{{ i }}">Apellido paterno:</label>
              <input type="text" id="apellidoPaterno{{ i }}" class="form-control"
                [(ngModel)]="investigador.apellidoPaterno" name="apellidoPaterno{{ i }}"
                [disabled]="investigador.agregado"
                (keypress)="onKeyPress($event, 'apellidoPaterno')"
                (input)="onInput($event, 'apellidoPaterno')" />
            </div>
            <div class="form-group">
              <label for="apellidoMaterno{{ i }}">Apellido materno:</label>
              <input type="text" id="apellidoMaterno{{ i }}" class="form-control"
                [(ngModel)]="investigador.apellidoMaterno" name="apellidoMaterno{{ i }}"
                [disabled]="investigador.agregado"
                (keypress)="onKeyPress($event, 'apellidoMaterno')"
                (input)="onInput($event, 'apellidoMaterno')" />
            </div>
          </ng-template>
          <br>
          <button type="button" class="btn btn-secondary"
            (click)="investigador.autorUnsis ? guardarAutorUnsis(investigador.autorUnsisSeleccionado, i) : agregarAutorNoUnsis(investigador, i)"
            *ngIf="!investigador.agregado">
            {{ investigador.autorUnsis ? 'Guardar autor UNSIS' : 'Registrar Autor' }}
          </button>
          <button type="button" class="btn btn-danger" (click)="eliminarInvestigador(i)">
            <i class="fa fa-trash" aria-hidden="true"></i> Eliminar
          </button>
        </div>
      </div>

      <div class="form-group">
        <label for="trimestre">Trimestre</label>
        <select id="trimestre" class="form-control" [(ngModel)]="selectedTrimestre" name="trimestre">
          <option *ngFor="let trimestre of trimestres" [value]="trimestre.id_trimestre">{{ trimestre.nombre }}</option>
        </select>
      </div>
      <div class="form-group">
        <label for="fechaPublicacion">Fecha de publicación</label>
        <input type="date" id="fechaPublicacion" class="form-control" [(ngModel)]="fechaPublicacion"
          name="fechaPublicacion">
      </div>
      <div class="form-group">
        <label for="isbn">ISBN impreso</label>
        <input type="text" id="isbnImpreso" class="form-control" [(ngModel)]="isbnImpreso" name="isbnImpreso">
      </div>
      <div class="form-group">
        <label for="isbn">ISBN digital</label>
        <input type="text" id="isbnDigital" class="form-control" [(ngModel)]="isbnDigital" name="isbnDigital">
      </div>
      <div class="form-group">
        <label for="doi">Indice MIAR</label>
        <input type="text" id="miar" class="form-control" [(ngModel)]="miar" name="miar">
      </div>

      <div class="form-group">
        <label>Compilado</label>
        <input type="checkbox" id="compilado" [(ngModel)]="compilado" name="compilado"
          (change)="onCheckboxChange($event, 'compilado')">
      </div>
      <div class="form-group">
        <label>Financiamiento Prodep</label>
        <input type="checkbox" id="prodep" [(ngModel)]="prodep" name="prodep"
          (change)="onCheckboxChange($event, 'prodep')">
      </div>
      <button type="button" class="btn btn-success" (click)="crearLibro()">
        <i class="fa fa-check"></i> Registrar
      </button>
    </div>

    <!-- Sección para Capítulo de libro -->
    <div *ngIf="tipoPublicacion === 'Capítulo de libro'">
      <div class="form-group">
        <label for="tituloCapitulo">Título del Capítulo</label>
        <input type="text" id="tituloCapitulo" class="form-control" [(ngModel)]="tituloCapitulo" name="tituloCapitulo"
          required>
      </div>
      <div class="form-group">
        <label for="tituloLibro">Título del Libro</label>
        <input type="text" id="tituloLibro" class="form-control" [(ngModel)]="tituloLibro" name="tituloLibro" required>
      </div>
      <div class="form-group">
        <label for="tituloLibro">Editorial</label>
        <input type="text" id="editorialCapitulo" class="form-control" [(ngModel)]="editorialCapitulo"
          name="editorialCapitulo" required>
      </div>
      <div class="form-group">
        <label for="institutoPublicacion">Instituto de afiliación</label>
        <select id="institutoPublicacion" class="form-control" [(ngModel)]="selectedInstitutoPublicacion"
          name="institutoPublicacion">
          <option *ngFor="let instituto of institutosPublicacion" [value]="instituto.id">{{ instituto.nombre }}</option>
        </select>
      </div>
      <div class="form-group">
        <label>Autores</label>
        <button type="button" class="btn btn-primary" (click)="agregarInvestigador()">
          <i class="fa fa-plus"></i> Agregar persona
        </button>
      </div>

      <div class="card mt-3" *ngFor="let investigador of investigadores; let i = index">
        <div class="card-body">
          <h5 class="card-title">Investigador {{ i + 1 }}</h5>
          <div class="form-group">
            <label>¿Autor UNSIS?</label>
            <input type="checkbox" id="autorUnsis{{ i }}" [(ngModel)]="investigador.autorUnsis" name="autorUnsis{{ i }}"
              [disabled]="investigador.agregado" (change)="onAutorUnsisChange(investigador, i)">
          </div>

          <div *ngIf="investigador.autorUnsis; else noAutorUnsis">
            <div class="form-group">
              <label for="instituto{{ i }}">Instituto</label>
              <select id="instituto{{ i }}" class="form-control" [(ngModel)]="investigador.instituto"
                name="instituto{{ i }}" (change)="onInstitutoChange(investigador.instituto, i)"
                [disabled]="investigador.agregado">
                <option *ngFor="let instituto of institutos" [value]="instituto.id">{{ instituto.nombre }}</option>
              </select>
            </div>
            <div class="form-group">
              <label for="listbox{{ i }}">Lista de autores UNSIS</label>
              <select id="listbox{{ i }}" class="form-control" [(ngModel)]="investigador.autorUnsisSeleccionado"
                name="listbox{{ i }}" [disabled]="investigador.agregado">
                <option *ngFor="let autor of autoresPorInstituto[i]" [value]="autor.autor.id_autor">{{
                  autor.nombre_1_investigador }} {{ autor.nombre_2_investigador }} {{
                  autor.apellido_paterno_1_investigador }} {{ autor.apellido_materno_2_investigador }}</option>
              </select>
            </div>
          </div>
          <ng-template #noAutorUnsis>
            <div class="form-group">
              <label for="primerNombre{{ i }}">Primer nombre:</label>
              <input type="text" id="primerNombre{{ i }}" class="form-control" [(ngModel)]="investigador.primerNombre"
                name="primerNombre{{ i }}" [disabled]="investigador.agregado"
                (keypress)="onKeyPress($event, 'primerNombre')"
                (input)="onInput($event, 'primerNombre')" />
            </div>
            <div class="form-group">
              <label for="segundoNombre{{ i }}">Segundo nombre:</label>
              <input type="text" id="segundoNombre{{ i }}" class="form-control" [(ngModel)]="investigador.segundoNombre"
                name="segundoNombre{{ i }}" [disabled]="investigador.agregado"
                (keypress)="onKeyPress($event, 'segundoNombre')"
                (input)="onInput($event, 'segundoNombre')" />
            </div>
            <div class="form-group">
              <label for="apellidoPaterno{{ i }}">Apellido paterno:</label>
              <input type="text" id="apellidoPaterno{{ i }}" class="form-control"
                [(ngModel)]="investigador.apellidoPaterno" name="apellidoPaterno{{ i }}"
                [disabled]="investigador.agregado"
                (keypress)="onKeyPress($event, 'apellidoPaterno')"
                (input)="onInput($event, 'apellidoPaterno')" />
            </div>
            <div class="form-group">
              <label for="apellidoMaterno{{ i }}">Apellido materno:</label>
              <input type="text" id="apellidoMaterno{{ i }}" class="form-control"
                [(ngModel)]="investigador.apellidoMaterno" name="apellidoMaterno{{ i }}"
                [disabled]="investigador.agregado"
                (keypress)="onKeyPress($event, 'apellidoMaterno')"
                (input)="onInput($event, 'apellidoMaterno')" />
            </div>
          </ng-template>
          <br>
          <button type="button" class="btn btn-secondary"
            (click)="investigador.autorUnsis ? guardarAutorUnsis(investigador.autorUnsisSeleccionado, i) : agregarAutorNoUnsis(investigador, i)"
            *ngIf="!investigador.agregado">
            {{ investigador.autorUnsis ? 'Guardar autor UNSIS' : 'Registrar Autor' }}
          </button>
          <button type="button" class="btn btn-danger" (click)="eliminarInvestigador(i)">
            <i class="fa fa-trash" aria-hidden="true"></i> Eliminar
          </button>
        </div>
      </div>

      <div class="form-group">
        <label for="trimestre">Trimestre</label>
        <select id="trimestre" class="form-control" [(ngModel)]="selectedTrimestre" name="trimestre">
          <option *ngFor="let trimestre of trimestres" [value]="trimestre.id_trimestre">{{ trimestre.nombre }}</option>
        </select>
      </div>
      <div class="form-group">
        <label for="fechaPublicacion">Fecha de publicación</label>
        <input type="date" id="fechaPublicacion" class="form-control" [(ngModel)]="fechaPublicacion"
          name="fechaPublicacion">
      </div>
      <div class="form-group-container">
        <div class="form-group">
          <label for="paginaInicio">Página de inicio</label>
          <input type="number" id="paginaInicio" class="form-control" [(ngModel)]="paginaInicio" name="paginaInicio" />
        </div>
        <div class="form-group">
          <label for="paginaFin">Página final</label>
          <input type="number" id="paginaFin" class="form-control" [(ngModel)]="paginaFin" name="paginaFin" />
        </div>
      </div>
      <div class="form-group">
        <label for="isbn">ISBN impreso</label>
        <input type="text" id="isbnImpreso" class="form-control" [(ngModel)]="isbnImpreso" name="isbnImpreso">
      </div>
      <div class="form-group">
        <label for="isbn">ISBN digital</label>
        <input type="text" id="isbnDigital" class="form-control" [(ngModel)]="isbnDigital" name="isbnDigital">
      </div>
      <div class="form-group">
        <label for="doi">Indice MIAR</label>
        <input type="text" id="miar" class="form-control" [(ngModel)]="miar" name="miar">
      </div>

      <div class="form-group">
        <label>Compilado</label>
        <input type="checkbox" id="compilado" [(ngModel)]="compilado" name="compilado"
          (change)="onCheckboxChange($event, 'compilado')">
      </div>
      <div class="form-group">
        <label>Financiamiento Prodep</label>
        <input type="checkbox" id="prodep" [(ngModel)]="prodep" name="prodep"
          (change)="onCheckboxChange($event, 'prodep')">
      </div>
      <button type="button" class="btn btn-success" (click)="crearCapitulo()">
        <i class="fa fa-check"></i> Registrar
      </button>
    </div>
  </form>
</div>